<div class="chat-container">
  <!-- Messages Container -->
  <div #scrollMe class="messages-container">
    <div *ngFor="let message of messages; let i = index" [ngClass]="{'user-message': message.isUser, 'assistant-message': !message.isUser, 'error-message': message.isError}" class="message">
      <div class="message-avatar">
        <nz-avatar [nzIcon]="message.isUser ? 'user' : 'robot'" [nzSize]="36"></nz-avatar>
      </div>
      <div class="message-content">
        <div class="message-role">
          {{ message.isUser ? 'You' : 'Tudor AI' }}
        </div>
        <div *ngIf="message.parsedContent" [innerHTML]="message.parsedContent" class="message-text"></div>
        <div *ngIf="!message.parsedContent" class="message-text">
          {{ message.content }}
        </div>
      </div>
    </div>

    <!-- Typing indicator when streaming -->
    <div *ngIf="isStreaming" class="typing-indicator">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
    
    <!-- Spacer to ensure scroll works correctly -->
    <div class="scroll-spacer"></div>
  </div>

  <!-- Input Container -->
  <div class="input-container">
    <div class="char-counter" [class.limit-reached]="isLimitReached">
      {{ getCharacterCountDisplay() }}
    </div>
    
    <div class="input-box">
      <textarea
        #messageInput
        [(ngModel)]="currentMessage"
        (keyup)="handleKeyUp($event)"
        [disabled]="isStreaming"
        class="message-input"
        placeholder="Type a message..."
        rows="1"
      ></textarea>
      
      <button 
        *ngIf="isStreaming"
        (click)="stopStreaming()"
        class="control-button stop-button"
        nz-button
        nzShape="circle"
      >
        <span nz-icon nzType="stop"></span>
      </button>
      
      <button
        (click)="sendMessage()"
        [disabled]="isSendButtonDisabled()"
        class="control-button send-button"
        nz-button
        nzShape="circle"
        nzType="primary"
      >
        <span nz-icon nzType="send"></span>
      </button>
    </div>
  </div>
</div>
