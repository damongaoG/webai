<div class="rewrite-container">
  <!-- Header -->
  <header class="rewrite-header">
    <div class="header-left">
      <h1 class="title">Tudor AI</h1>
    </div>
    <div class="header-actions">
      <app-button
        variant="default"
        shape="circle"
        size="medium"
        (clicked)="toggleChatHistory()"
        [title]="showChatHistory ? 'Hide history' : 'Show history'"
        customClass="header-btn"
      >
        <app-icon name="history" [size]="16"></app-icon>
      </app-button>
      <app-button
        variant="default"
        shape="circle"
        size="medium"
        (clicked)="startNewChat()"
        title="New chat"
        customClass="header-btn"
      >
        <app-icon name="plus" [size]="16"></app-icon>
      </app-button>
      <app-button
        variant="primary"
        shape="circle"
        size="medium"
        (clicked)="saveChat()"
        title="Save chat"
        customClass="header-btn"
      >
        <app-icon name="save" [size]="16"></app-icon>
      </app-button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="rewrite-content">
    <!-- Chat History Sidebar -->
    <aside class="chat-history-sidebar" *ngIf="showChatHistory && !isMobile">
      <div class="sidebar-header">
        <h3>Chat History</h3>
      </div>
      <div class="history-list" (scroll)="onHistoryScroll($event)">
        <div *ngIf="chatHistory.length === 0" class="empty-history">
          <p>No chat history yet.</p>
        </div>
        <div
          *ngFor="let history of chatHistory"
          class="history-item"
          [class.active]="activeHistoryId === history.sessionId"
          (click)="loadChat(history)"
        >
          <div class="history-title">
            {{
              truncateContent(history.messages[0]?.content || "Untitled Chat")
            }}
          </div>
          <div class="history-time">
            {{ history.updateTime | date: "short" }}
          </div>
        </div>
        <div *ngIf="isLoading" class="loading-more">
          <app-spinner
            [simple]="true"
            text="Loading more..."
            size="small"
          ></app-spinner>
        </div>
      </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
      <app-chat-bot></app-chat-bot>
    </main>
  </div>

  <!-- Mobile Menu (only shown on mobile) -->
  <div class="mobile-menu" *ngIf="isMobile">
    <app-button
      variant="default"
      shape="circle"
      size="medium"
      (clicked)="toggleChatHistory()"
      [title]="showChatHistory ? 'Hide history' : 'Show history'"
    >
      <app-icon name="history" [size]="16"></app-icon>
    </app-button>
    <app-button
      variant="default"
      shape="circle"
      size="medium"
      (clicked)="startNewChat()"
      title="New chat"
    >
      <app-icon name="plus" [size]="16"></app-icon>
    </app-button>
    <app-button
      variant="primary"
      shape="circle"
      size="medium"
      (clicked)="saveChat()"
      title="Save chat"
    >
      <app-icon name="save" [size]="16"></app-icon>
    </app-button>
  </div>

  <!-- Mobile History Overlay (when showing history on mobile) -->
  <div class="mobile-history-overlay" *ngIf="showChatHistory && isMobile">
    <div class="mobile-history-container">
      <div class="mobile-history-header">
        <h3>Chat History</h3>
        <app-button
          variant="ghost"
          size="small"
          (clicked)="toggleChatHistory()"
        >
          <app-icon name="x" [size]="16"></app-icon>
        </app-button>
      </div>
      <div class="mobile-history-content">
        <div *ngIf="chatHistory.length === 0" class="empty-history">
          <p>No chat history yet.</p>
        </div>
        <div
          *ngFor="let history of chatHistory"
          class="history-item"
          [class.active]="activeHistoryId === history.sessionId"
          (click)="loadChat(history)"
        >
          <div class="history-title">
            {{
              truncateContent(history.messages?.[0]?.content || "Untitled Chat")
            }}
          </div>
          <div class="history-time">
            {{ history.updateTime | date: "short" }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
