<div class="rewrite-container">
  <!-- Header -->
  <header class="rewrite-header">
    <div class="header-left">
      <h1 class="title">Tudor AI</h1>
    </div>
    <div class="header-actions">
      <button 
        nz-button 
        nzType="default" 
        nzShape="circle"
        (click)="toggleChatHistory()"
        [title]="showChatHistory ? 'Hide history' : 'Show history'"
        class="header-btn"
      >
        <span nz-icon nzType="history"></span>
      </button>
      <button 
        nz-button 
        nzType="default" 
        nzShape="circle" 
        (click)="startNewChat()"
        title="New chat"
        class="header-btn"
      >
        <span nz-icon nzType="plus"></span>
      </button>
      <button 
        nz-button 
        nzType="primary" 
        nzShape="circle" 
        (click)="saveChat()"
        title="Save chat"
        class="header-btn"
      >
        <span nz-icon nzType="save"></span>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="rewrite-content">
    <!-- Chat History Sidebar -->
    <aside class="chat-history-sidebar" *ngIf="showChatHistory && !isMobile">
      <div class="sidebar-header">
        <h3>Chat History</h3>
      </div>
      <div class="history-list" (scroll)="onHistoryScroll($event)">
        <div *ngIf="chatHistory.length === 0" class="empty-history">
          <p>No chat history yet.</p>
        </div>
        <div 
          *ngFor="let history of chatHistory" 
          class="history-item"
          [class.active]="activeHistoryId === history.sessionId"
          (click)="loadChat(history)"
        >
          <div class="history-title">
            {{ truncateContent(history.messages[0]?.content || 'Untitled Chat') }}
          </div>
          <div class="history-time">
            {{ history.updateTime | date:'short' }}
          </div>
        </div>
        <div *ngIf="isLoading" class="loading-more">
          <nz-spin nzSimple></nz-spin>
          <span>Loading more...</span>
        </div>
      </div>
    </aside>
    
    <!-- Main Chat Area -->
    <main class="chat-main">
      <app-chat-bot></app-chat-bot>
    </main>
  </div>

  <!-- Mobile Menu (only shown on mobile) -->
  <div class="mobile-menu" *ngIf="isMobile">
    <button 
      nz-button 
      nzType="default" 
      nzShape="circle"
      (click)="toggleChatHistory()"
      [title]="showChatHistory ? 'Hide history' : 'Show history'"
    >
      <span nz-icon nzType="history"></span>
    </button>
    <button 
      nz-button 
      nzType="default" 
      nzShape="circle" 
      (click)="startNewChat()"
      title="New chat"
    >
      <span nz-icon nzType="plus"></span>
    </button>
    <button 
      nz-button 
      nzType="primary" 
      nzShape="circle" 
      (click)="saveChat()"
      title="Save chat"
    >
      <span nz-icon nzType="save"></span>
    </button>
  </div>

  <!-- Mobile History Overlay (when showing history on mobile) -->
  <div class="mobile-history-overlay" *ngIf="showChatHistory && isMobile">
    <div class="mobile-history-container">
      <div class="mobile-history-header">
        <h3>Chat History</h3>
        <button nz-button nzType="text" (click)="toggleChatHistory()">
          <span nz-icon nzType="close"></span>
        </button>
      </div>
      <div class="mobile-history-content">
        <div *ngIf="chatHistory.length === 0" class="empty-history">
          <p>No chat history yet.</p>
        </div>
        <div 
          *ngFor="let history of chatHistory" 
          class="history-item"
          [class.active]="activeHistoryId === history.sessionId"
          (click)="loadChat(history)"
        >
          <div class="history-title">
            {{ truncateContent(history.messages?.[0]?.content || 'Untitled Chat') }}
          </div>
          <div class="history-time">
            {{ history.updateTime | date:'short' }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
