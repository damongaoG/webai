<!-- Using the reusable centered layout component -->
<app-centered-layout>
  <!-- Original login component -->
  <div
    class="mx-auto overflow-hidden rounded-2xl bg-default-950/40 backdrop-blur-2xl"
  >
    <div class="grid gap-10 lg:grid-cols-2">
      <auth-image />
      <div class="flex h-full flex-col p-10 lg:ps-0">
        <div class="pb-10">
          <a routerLink="/" class="flex">
            <div
              class="text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent hover:from-blue-500 hover:via-purple-500 hover:to-indigo-500 transition-all duration-300 tracking-wider"
            >
              <span class="font-black">Tudor</span
              ><span class="font-light italic">AI</span>
            </div>
          </a>
        </div>
        <div class="pb6 my-auto">
          <h4 class="mb-4 text-2xl font-bold text-white">Get Started Now</h4>
          <p class="mb-8 max-w-sm text-default-300">
            Enter your email address and password to access account.
          </p>

          <form
            [formGroup]="signInForm"
            (ngSubmit)="login()"
            class="text-start"
          >
            <!-- Error Message -->
            <div
              *ngIf="errorMessage"
              class="mb-4 p-2 bg-red-500/20 text-red-400 rounded"
            >
              {{ errorMessage }}
            </div>

            <div class="mb-4">
              <label
                for="emailaddress"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Email address</label
              >
              <input
                formControlName="email"
                class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                type="email"
                id="emailaddress"
                required=""
                placeholder="Enter your email"
                [ngClass]="{
                  'border-red-500': submitted && formValues['email'].errors,
                }"
              />
              <div
                *ngIf="submitted && formValues['email'].errors"
                class="text-red-400 text-sm mt-1"
              >
                <span *ngIf="formValues['email'].errors['required']"
                  >Email is required</span
                >
                <span *ngIf="formValues['email'].errors['email']"
                  >Please enter a valid email address</span
                >
              </div>
            </div>

            <div class="mb-4">
              <label
                for="password"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Password</label
              >
              <input
                formControlName="password"
                class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                type="password"
                required=""
                id="password"
                placeholder="Enter your password"
                [ngClass]="{
                  'border-red-500': submitted && formValues['password'].errors,
                }"
              />
              <div
                *ngIf="submitted && formValues['password'].errors"
                class="text-red-400 text-sm mt-1"
              >
                <span *ngIf="formValues['password'].errors['required']"
                  >Password is required</span
                >
                <span *ngIf="formValues['password'].errors['minlength']"
                  >Password must be at least 6 characters</span
                >
              </div>
            </div>

            <!-- CAPTCHA Verification (shown conditionally) -->
            <div *ngIf="showVerifyCode" class="mb-4">
              <label
                for="verifyCode"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Verification Code</label
              >
              <div class="flex gap-2">
                <input
                  formControlName="verifyCode"
                  class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                  type="text"
                  id="verifyCode"
                  placeholder="Enter code"
                />
                <div class="flex-shrink-0">
                  <img
                    [src]="kaptchaUrl"
                    alt="CAPTCHA"
                    class="h-10 cursor-pointer"
                    (click)="refreshKaptcha()"
                  />
                </div>
              </div>
            </div>

            <div class="mb-6">
              <div class="flex flex-wrap items-center justify-between gap-y-1">
                <div>
                  <input
                    formControlName="rememberMe"
                    type="checkbox"
                    class="text-primary-600 focus:border-primary-300 h-4 w-4 rounded border-white/20 bg-white/20 text-primary shadow-sm focus:ring focus:ring-primary/60 focus:ring-offset-0"
                    id="checkbox-signin"
                  />
                  <label
                    class="ms-2 align-middle text-default-200"
                    for="checkbox-signin"
                    >Remember me</label
                  >
                </div>
                <a
                  routerLink="/auth/forgot-pw"
                  class="border-b border-dashed text-default-200"
                  ><small>Forgot your password?</small></a
                >
              </div>
            </div>

            <div class="mb-6 text-center">
              <button
                class="bg-primary-600/90 hover:bg-primary-600 group mt-5 inline-flex w-full items-center justify-center rounded-lg px-6 py-2 text-white backdrop-blur-2xl transition-all duration-500"
                type="submit"
                [disabled]="isLoading"
              >
                <span *ngIf="isLoading" class="mr-2">
                  <svg
                    class="animate-spin h-5 w-5 text-white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <circle
                      class="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="4"
                    ></circle>
                    <path
                      class="opacity-75"
                      fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                    ></path>
                  </svg>
                </span>
                <span class="fw-bold">Sign In</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-5 w-full text-center">
    <p class="text-base font-medium leading-6 text-default-300">
      Don't have an account?
      <a routerLink="/auth/register" class="ms-1 font-semibold text-primary"
        >Sign Up</a
      >
    </p>
  </div>
</app-centered-layout>
