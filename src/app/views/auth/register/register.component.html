<app-centered-layout>
  <div
    class="mx-auto max-w-5xl overflow-hidden rounded-2xl bg-default-950/40 backdrop-blur-2xl"
  >
    <div class="grid gap-10 lg:grid-cols-2">
      <auth-image />

      <div class="flex h-full flex-col p-10 lg:ps-0">
        <div class="pb-10">
          <a routerLink="/" class="flex">
            <img src="assets/images/logo.png" alt="dark logo" class="h-10" />
          </a>
        </div>

        <!-- Registration Form -->
        <div class="pb6 my-auto" *ngIf="!showVerification">
          <h4 class="mb-4 text-2xl font-bold text-white">Get Started Now</h4>
          <p class="mb-8 max-w-sm text-default-300">
            Enter your information to create an account.
          </p>

          <form
            [formGroup]="registerForm"
            (ngSubmit)="submitForm()"
            class="text-start"
          >
            <!-- Email -->
            <div class="mb-4">
              <label
                for="email"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Email address</label
              >
              <input
                class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                type="email"
                id="email"
                formControlName="email"
                placeholder="Enter your email"
              />
              <div
                *ngIf="
                  registerForm.get('email')?.invalid &&
                  registerForm.get('email')?.touched
                "
                class="text-red-500 mt-1 text-sm"
              >
                <span *ngIf="registerForm.get('email')?.errors?.['required']"
                  >Email is required</span
                >
                <span *ngIf="registerForm.get('email')?.errors?.['email']"
                  >Please enter a valid email</span
                >
                <span
                  *ngIf="
                    registerForm.get('email')?.errors?.['invalidEmailFormat']
                  "
                  >Email format is invalid</span
                >
                <span
                  *ngIf="registerForm.get('email')?.errors?.['invalidDomain']"
                  >Email domain is invalid</span
                >
              </div>
            </div>

            <!-- Nickname -->
            <div class="mb-4">
              <label
                for="nickName"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Your Name (optional)</label
              >
              <input
                type="text"
                id="nickName"
                formControlName="nickName"
                class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                placeholder="Your Name"
              />
              <div
                *ngIf="
                  registerForm.get('nickName')?.invalid &&
                  registerForm.get('nickName')?.touched
                "
                class="text-red-500 mt-1 text-sm"
              >
                <span
                  *ngIf="registerForm.get('nickName')?.errors?.['minlength']"
                  >Name must be at least 2 characters</span
                >
                <span
                  *ngIf="registerForm.get('nickName')?.errors?.['maxlength']"
                  >Name must be less than 20 characters</span
                >
              </div>
            </div>

            <!-- Invitation Code -->
            <div class="mb-4">
              <label
                for="invitationCode"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Invitation Code</label
              >
              <input
                class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                type="text"
                id="invitationCode"
                formControlName="invitationCode"
                placeholder="Enter invitation code"
              />
              <div
                *ngIf="
                  registerForm.get('invitationCode')?.invalid &&
                  registerForm.get('invitationCode')?.touched
                "
                class="text-red-500 mt-1 text-sm"
              >
                <span
                  *ngIf="
                    registerForm.get('invitationCode')?.errors?.['required']
                  "
                  >Invitation code is required</span
                >
              </div>
            </div>

            <!-- Password -->
            <div class="mb-4">
              <label
                for="password"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Password</label
              >
              <input
                class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                type="password"
                id="password"
                formControlName="password"
                placeholder="Enter your password"
              />
              <div
                *ngIf="
                  registerForm.get('password')?.invalid &&
                  registerForm.get('password')?.touched
                "
                class="text-red-500 mt-1 text-sm"
              >
                <span *ngIf="registerForm.get('password')?.errors?.['required']"
                  >Password is required</span
                >
                <span
                  *ngIf="registerForm.get('password')?.errors?.['minlength']"
                  >Password must be at least 6 characters</span
                >
                <span
                  *ngIf="
                    registerForm.get('password')?.errors?.[
                      'invalidSpecialCharacters'
                    ]
                  "
                  >Password contains invalid characters</span
                >
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="mb-4">
              <label
                for="confirmPassword"
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Confirm Password</label
              >
              <input
                class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                type="password"
                id="confirmPassword"
                formControlName="confirmPassword"
                placeholder="Confirm your password"
              />
              <div
                *ngIf="
                  registerForm.get('confirmPassword')?.invalid &&
                  registerForm.get('confirmPassword')?.touched
                "
                class="text-red-500 mt-1 text-sm"
              >
                <span
                  *ngIf="
                    registerForm.get('confirmPassword')?.errors?.['required']
                  "
                  >Please confirm your password</span
                >
                <span
                  *ngIf="
                    registerForm.get('confirmPassword')?.errors?.['mismatch']
                  "
                  >Passwords do not match</span
                >
              </div>
            </div>

            <!-- Remember Me -->
            <div class="mb-6">
              <input
                type="checkbox"
                class="text-primary-600 focus:border-primary-300 h-4 w-4 rounded border-white/20 bg-white/20 text-primary shadow-sm focus:ring focus:ring-primary/60 focus:ring-offset-0"
                id="rememberMe"
                formControlName="rememberMe"
              />
              <label class="ms-2 align-middle text-default-200" for="rememberMe"
                >Remember me</label
              >
            </div>

            <!-- Submit Button -->
            <div class="mb-6 text-center">
              <button
                class="bg-primary-600/90 hover:bg-primary-600 group mt-5 inline-flex w-full items-center justify-center rounded-lg px-6 py-2 text-white backdrop-blur-2xl transition-all duration-500"
                type="submit"
                [disabled]="isLoading"
              >
                <span *ngIf="!isLoading" class="fw-bold">Sign Up</span>
                <span *ngIf="isLoading" class="fw-bold">Processing...</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Verification Form -->
        <div class="pb6 my-auto" *ngIf="showVerification">
          <h4 class="mb-4 text-2xl font-bold text-white">Email Verification</h4>
          <p class="mb-8 max-w-sm text-default-300">
            We have sent a verification email to
            <strong>{{ registeredUsername }}</strong
            >. Please check your inbox and verify your email.
          </p>

          <form [formGroup]="verificationForm" class="text-start">
            <div class="mb-4">
              <label
                class="mb-2 block text-base/normal font-semibold text-default-200"
                >Verification Code</label
              >
              <div class="flex items-center gap-2">
                <input
                  class="block w-full rounded border-default-200 border-white/10 bg-transparent px-3 py-1.5 text-white/80 focus:border-white/25 focus:ring-transparent"
                  type="text"
                  formControlName="verifyCode"
                  placeholder="Enter verification code"
                />
                <img
                  [src]="kaptchaUrl"
                  alt="Captcha"
                  class="h-10 rounded"
                  (click)="refreshKaptcha()"
                />
              </div>
            </div>

            <div class="mb-6 text-center">
              <button
                class="bg-primary-600/90 hover:bg-primary-600 group mt-5 inline-flex w-full items-center justify-center rounded-lg px-6 py-2 text-white backdrop-blur-2xl transition-all duration-500"
                (click)="resendEmail()"
                [disabled]="
                  countdownTime > 0 ||
                  !verificationForm.get('verifyCode')?.value
                "
              >
                <span *ngIf="countdownTime <= 0" class="fw-bold"
                  >Resend Verification Email</span
                >
                <span *ngIf="countdownTime > 0" class="fw-bold"
                  >Resend in {{ countdownTime }}s</span
                >
              </button>
            </div>

            <div class="mb-6 text-center">
              <button
                class="border border-white/10 hover:bg-white/5 group mt-2 inline-flex w-full items-center justify-center rounded-lg px-6 py-2 text-white backdrop-blur-2xl transition-all duration-500"
                (click)="navigateToLogin()"
              >
                <span class="fw-bold">Back to Login</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-5 w-full text-center">
    <p class="text-base font-medium leading-6 text-default-300">
      Already have an account?
      <a routerLink="/auth/login" class="ms-1 font-semibold text-primary"
        >Sign In</a
      >
    </p>
  </div>
</app-centered-layout>
