<div class="feature-card-wrapper">
  <div
    class="feature-card h-16 sm:h-20 bg-white/40 shadow-[0px_4px_4px_0px_rgba(0,0,0,0.05)] border-2 border-white backdrop-blur-[5px] flex items-center justify-between px-3 sm:px-4 lg:px-6 rounded-lg sm:margin-top: 2rem"
    style="margin-top: 1rem"
    [ngClass]="{
      'opacity-50 cursor-not-allowed': !isInteractionAllowed,
      'hover:bg-white/50': isInteractionAllowed,
    }"
    [class]="featureCard.additionalClasses || ''"
  >
    <!-- Left side: Icon, title, and star -->
    <div class="flex items-center min-w-0 flex-1">
      <div class="icon-container flex items-center gap-2 sm:gap-3 min-w-0">
        <div class="task-container flex-shrink-0">
          <img
            [src]="featureCard.iconPath"
            class="w-4 sm:w-5"
            [alt]="featureCard.iconAlt"
          />
        </div>
        <div class="title-container flex items-center gap-1 sm:gap-2 min-w-0">
          <div
            class="text-zinc-800 text-sm sm:text-lg lg:text-xl font-bold keywords-title truncate"
          >
            {{ featureCard.title }}
          </div>
          <img
            src="/assets/images/icon/star.svg"
            alt="Star"
            class="w-4 h-4 sm:w-6 sm:h-6 flex-shrink-0"
          />
        </div>
      </div>
    </div>

    <!-- Center: Green gradient indicator - initially hidden -->
    <div
      class="absolute right-0 gradient-indicator cursor-pointer flex items-center w-16 sm:w-20 lg:w-28 h-8 sm:h-10 bg-[radial-gradient(ellipse_50.00%_50.00%_at_50.00%_50.00%,_#64E9A7_0%,_rgba(147,_238,_196,_0.50)_100%)] rounded-md"
      [class.visible]="cardState.showGradient"
    ></div>

    <!-- Right side: Undo/Redo (conditional) and Expand button -->
    <div class="flex items-center gap-3 flex-shrink-0 z-10">
      @if (shouldShowUndoButton) {
        <button
          type="button"
          class="undo-btn flex items-center gap-1 text-stone-600 text-xs sm:text-sm px-2 py-1 rounded hover:bg-white/60"
          (click)="onUndoClick()"
        >
          <i class="mdi mdi-undo text-base sm:text-lg"></i>
          <span>Undo</span>
        </button>
      }

      @if (shouldShowRedoButton) {
        <button
          type="button"
          class="redo-btn flex items-center gap-1 text-stone-600 text-xs sm:text-sm px-2 py-1 rounded hover:bg-white/60"
          (click)="onRedoClick()"
        >
          <i class="mdi mdi-redo text-base sm:text-lg"></i>
          <span>Redo</span>
        </button>
      }

      <div
        class="expand expand-icon"
        [class.expanded]="shouldShowExpandableContent"
        [class.cursor-pointer]="!isExpandDisabled"
        [class.cursor-not-allowed]="isExpandDisabled"
        [class.opacity-50]="isExpandDisabled"
        [attr.aria-disabled]="isExpandDisabled ? 'true' : null"
        [attr.role]="'button'"
        [attr.tabindex]="isExpandDisabled ? -1 : 0"
        [style.pointer-events]="isExpandDisabled ? 'none' : null"
        (click)="onExpandClick()"
        (mouseenter)="onExpandHoverStart()"
        (mouseleave)="onExpandHoverEnd()"
      >
        <div class="flex flex-row items-center gap-1">
          <img
            src="/assets/images/icon/expand-one.svg"
            alt="Expand"
            class="w-5 h-5 sm:w-6 sm:h-6 transition-transform duration-200"
            [class.rotate-180]="shouldShowExpandableContent"
          />
          <div
            class="text-stone-500 text-xs sm:text-sm font-normal text-center"
          >
            {{ shouldShowExpandableContent ? "Collapse" : "Expand" }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div
    class="px-4 sm:px-6 lg:px-8 relative"
    [class.arrow-loading]="getLoadingState()"
  >
    <div
      class="h-0 outline outline-1 outline-offset-[-0.50px] outline-gray-400/30"
    ></div>
    <img
      src="/assets/images/icon/arrow-right-01.svg"
      alt=""
      class="arrow-right absolute -top-1.5 left-4 sm:left-6 w-3 h-3 sm:w-4 sm:h-4"
    />
    <img
      src="/assets/images/icon/arrow-left.svg"
      alt=""
      class="arrow-left absolute -top-1.5 right-4 sm:right-6 w-3 h-3 sm:w-4 sm:h-4"
    />
  </div>

  <!-- Expandable Content Section -->
  @if (shouldShowExpandableContent) {
    <app-expandable-content
      [expandableState]="cardState.expandable"
      [keywordsData]="keywordsData"
      [argumentsData]="argumentsData"
      [scholars]="scholarsData"
      [caseItems]="caseItemsData"
      [isCasesLoading]="isLoadingCases()"
      [isSummaryLoading]="isLoadingSummary()"
      [summaryText]="summaryText"
      (keywordSelected)="onKeywordSelected($event)"
      (keywordDeselected)="onKeywordDeselected($event)"
      (argumentSelected)="onArgumentSelected($event)"
      (argumentDeselected)="onArgumentDeselected($event)"
      (generateEssay)="onGenerateEssay()"
    />
  }

  <!-- Wordcount Input Modal -->
  <app-wordcount-input-modal
    *ngIf="featureCard.id === 'summary'"
    [visible]="wordcountModalVisible()"
    [essayId]="essayIdForModal()"
    (visibleChange)="wordcountModalVisible.set($event)"
    (confirmed)="onWordcountConfirmed($event)"
    (bodyItem)="onBodyItem($event)"
    (bodyError)="onBodyError($event)"
    (bodyComplete)="onBodyComplete()"
  />
</div>
